<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Boss Spawn Countdown</title>
  <style>
    html, body { height: 100%; margin: 0; }
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: url('image.png') no-repeat center/cover fixed;
      color: white;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
    }
    .container {
      background-color: rgba(0,0,0,0.55);
      padding: 20px;
      border-radius: 12px;
      width: 95%;
      max-width: 980px;
      backdrop-filter: blur(2px);
    }
    h2 { margin: 0 0 10px 0; }

    .pill {
      display:inline-block;
      padding:8px 14px;
      border-radius:10px;
      font-weight:bold;
      background:url('wood.png') no-repeat center/cover;
      color:#fff5ea;
      border:1px solid rgba(255,255,255,0.35);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.25);
      margin: 6px;
    }

    .tz-combo-wrap { display:flex; justify-content:center; }
    .tz-toggle-combo {
      display:inline-flex; align-items:center; gap:10px;
      padding: 8px 14px;
      border-radius:10px;
      background:url('wood.png') no-repeat center/cover;
      color:#fff5ea;
      border:1px solid rgba(255,255,255,0.35);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.25);
      margin: 6px;
      cursor: pointer;
      text-align: left;
      appearance:none; -webkit-appearance:none; border-width:1px;
    }
    .tz-label { font-weight: normal; opacity:.95; }
    .tz-value { font-weight: bold; }
    .tz-caret { margin-left: 4px; opacity:.9; }

    .tz-menu {
      position: absolute;
      top: calc(100% + 6px);
      left: 50%;
      transform: translateX(-50%);
      width: min(560px, 92vw);
      display: none;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,0.4);
      box-shadow: 0 10px 24px rgba(0,0,0,0.5);
      z-index: 100;
    }
    .tz-menu.open { display: block; }
    .tz-search {
      padding: 10px 12px;
      border: none;
      outline: none;
      width: 100%;
      color: #fff5ea;
      background: url('wood.png') no-repeat center/cover;
    }
    .tz-list {
      max-height: 280px;
      overflow-y: auto;
      background: url('wood.png') repeat center/cover;
    }
    .tz-item {
      padding: 10px 12px;
      cursor: pointer;
      color: #fff5ea;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    .tz-item:last-child { border-bottom: none; }
    .tz-item:hover, .tz-item.active { background: rgba(255,255,255,0.15); }

    .help { opacity:.9; margin: 4px 0 8px; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      background: rgba(0,0,0,0.7);
    }
    th, td {
      border: 1px solid white;
      padding: 8px;
      text-align: center;
      white-space: nowrap;
    }
    th { background: rgba(255,255,255,0.25); }
    td:first-child, th:first-child { min-width: 140px; }
    .nextTime { font-weight: 700; }
    .soon { color: #00ffcc; }
    .now { color: #ffea00; font-weight: 800; }

    .boss-cell { position: relative; padding-left: 60px; }
    .pvp-badge {
      position: absolute; left: 8px; top: 50%; transform: translateY(-50%);
      color: #2cff9a; font-weight: 700; letter-spacing: .5px; text-transform: uppercase;
    }
    .boss-name { display:block; text-align:center; width:100%; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Boss Spawn Countdown</h2>

    <div class="pill">Server reset: <span id="serverResetLabel"></span> (CEST)</div>

    <div class="tz-combo-wrap">
      <button type="button" class="tz-toggle-combo" id="tzToggle" aria-haspopup="listbox" aria-expanded="false">
        <span class="tz-label">Your Timezone:</span>
        <span class="tz-value" id="tzCurrent">Loading…</span>
        <span class="tz-caret">▾</span>
      </button>
    </div>

    <div class="tz-menu" id="tzMenu" role="listbox">
      <input class="tz-search" id="tzSearch" placeholder="Search city/region…">
      <div class="tz-list" id="tzList"></div>
    </div>

    <div class="help">Times below are shown in your selected timezone.</div>

    <table>
      <thead>
        <tr>
          <th>Boss</th>
          <th>Location</th>
          <th>Interval</th>
          <th>Next Spawn</th>
          <th>Countdown</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <script>
    /* ===== CONFIG ===== */
    const SERVER_RESET_HHMM = "05:15";
    const CEST_OFFSET_HOURS = 2;           // fixed +02:00 (no DST)
    const FIXED_LABEL = "CEST";

    // Your bosses (unchanged)
    const BOSSES = [
      { name: "Anubis",               location: "Alexandria - Pyramid",       interval: 3 },
      { name: "Lost King",            location: "Madeira",                    interval: 3 },
      { name: "Shogun",               location: "Edo",                        interval: 4 },
      { name: "Minotaur",             location: "Crete - Labyrinth",          interval: 4 },
      { name: "Golden Buddha",        location: "Semerang",                   interval: 4 },
      { name: "Hell Hound",           location: "Stockholm",                  interval: 4 },
      { name: "General Charlie Will", location: "London - Tortuga",           interval: 12 },
      { name: "General Cruz",         location: "Seville - Tortuga",          interval: 12 },

      { name: "PvP - Strange Pirate Chief", location: "Jamestown",     interval: 1 },
      { name: "PvP - Rock Man",             location: "Jamestown",     interval: 2 },
      { name: "PvP - Lost Waterway Pirate", location: "New Amsterdam", interval: 1 },
      { name: "PvP - General Ken",          location: "New Amsterdam", interval: 2 },

      { name: "PvP - General Justin", location: "Mogadishu",                    fixedCET: "12:00" },
	  { name: "PvP - Ice Dragon",     location: "Basra",                        fixedCET: "18:00" },
      { name: "PvP - King Kong",      location: "Luanda (Congo Jungle)",        fixedCET: "19:00" },
      { name: "PvP - Hydra",          location: "Zhigu - Hydra cave of flames", fixedCET: "21:00" },
      { name: "PvP - Fenrir",         location: "Oslo",                         fixedCET: "22:00" },
    ];
    /* ==================== */

    const serverResetLabel = document.getElementById("serverResetLabel");
    serverResetLabel.textContent = SERVER_RESET_HHMM;

    const tbody = document.getElementById("tbody");
    function pad(n){ return n.toString().padStart(2,"0"); }
    function fmtHMInTZ(date, tz) {
      return new Intl.DateTimeFormat("en-GB", {
        hour: "2-digit", minute: "2-digit", hour12: false, timeZone: tz
      }).format(date);
    }
    function fmtHMS(ms){
      if (ms < 0) ms = 0;
      const s = Math.floor(ms/1000);
      const h = Math.floor(s/3600);
      const m = Math.floor((s%3600)/60);
      const ss = s%60;
      return `${pad(h)}:${pad(m)}:${pad(ss)}`;
    }
    function utcOffsetLabel(tz, atDate = new Date()){
      const parts = new Intl.DateTimeFormat("en-US", { timeZone: tz, timeZoneName: "shortOffset", hour: "2-digit" }).formatToParts(atDate);
      const p = parts.find(x => x.type === "timeZoneName");
      return p ? p.value.replace("GMT","UTC") : "UTC";
    }

    /* Build an absolute Date for "today at HH:MM" in a fixed offset (+02:00) zone */
    function fixedOffsetTodayAt(offsetHours, hh, mm){
      // "Local day" in that offset:
      const nowUTC = new Date();
      const localMs = nowUTC.getTime() + offsetHours*3600*1000;
      const local = new Date(localMs);
      const y = local.getUTCFullYear(), m = local.getUTCMonth(), d = local.getUTCDate();
      // Convert that local (offset) wall-clock to an absolute UTC instant:
      const utcMs = Date.UTC(y, m, d, hh - offsetHours, mm, 0, 0);
      return new Date(utcMs);
    }

    // Interval bosses — anchored to server reset in fixed CEST
    function nextFromResetInterval(intervalHours){
      const [h, m] = SERVER_RESET_HHMM.split(":").map(Number);
      const resetToday = fixedOffsetTodayAt(CEST_OFFSET_HOURS, h, m);
      const now = new Date();
      const lastReset = (now >= resetToday) ? resetToday : new Date(resetToday.getTime() - 24*3600*1000);
      const step = intervalHours * 3600 * 1000;
      const elapsed = now - lastReset;
      if (elapsed < 0) return lastReset;
      const k = Math.ceil(elapsed / step);
      return new Date(lastReset.getTime() + k * step);
    }

    // Fixed-time bosses — daily at HH:MM in fixed CEST
    function nextFromFixedCEST(hhmm){
      const [hh, mm] = hhmm.split(":").map(Number);
      const todayAt = fixedOffsetTodayAt(CEST_OFFSET_HOURS, hh, mm);
      const now = new Date();
      return (now <= todayAt) ? todayAt : new Date(todayAt.getTime() + 24*3600*1000);
    }

    function buildRows() {
      tbody.innerHTML = "";
      BOSSES.forEach((b, i) => {
        const isPvP = b.name.startsWith("PvP -");
        const bossLabel = isPvP ? b.name.replace(/^PvP -\s*/i, "") : b.name;
        const bossCell = isPvP
          ? `<td class="boss-cell"><span class="pvp-badge">PvP</span><span class="boss-name">${bossLabel}</span></td>`
          : `<td>${bossLabel}</td>`;
        const intervalCell = b.fixedCET ? `${b.fixedCET} ${FIXED_LABEL}` : `${b.interval}h`;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          ${bossCell}
          <td>${b.location}</td>
          <td>${intervalCell}</td>
          <td class="nextTime" id="next-${i}">--:--</td>
          <td id="cd-${i}">--:--:--</td>
        `;
        tbody.appendChild(tr);
      });
    }

    /* Timezone picker (combined tab) */
    const tzToggle = document.getElementById("tzToggle");
    const tzMenu = document.getElementById("tzMenu");
    const tzSearch = document.getElementById("tzSearch");
    const tzList = document.getElementById("tzList");
    const tzCurrent = document.getElementById("tzCurrent");

    const ALL_TZS = (Intl.supportedValuesOf && Intl.supportedValuesOf("timeZone")) || [
      "Europe/Vienna","Europe/Berlin","UTC","America/New_York","America/Los_Angeles","Asia/Tokyo","Australia/Sydney"
    ];

    function renderTzList(filter = "") {
      tzList.innerHTML = "";
      const q = filter.trim().toLowerCase();
      ALL_TZS.filter(tz => tz.toLowerCase().includes(q)).forEach(tz => {
        const div = document.createElement("div");
        div.className = "tz-item";
        const label = `${tz} (${utcOffsetLabel(tz)})`;
        div.textContent = label;
        div.dataset.tz = tz;
        div.addEventListener("click", () => selectTimezone(tz, label));
        tzList.appendChild(div);
      });
    }
    function openTzMenu(){ tzMenu.classList.add("open"); tzToggle.setAttribute("aria-expanded","true"); tzSearch.value=""; renderTzList(""); setTimeout(()=>tzSearch.focus(),0); }
    function closeTzMenu(){ tzMenu.classList.remove("open"); tzToggle.setAttribute("aria-expanded","false"); }
    function selectTimezone(tz, label){ localStorage.setItem("boss_timezone", tz); tzCurrent.textContent = label; closeTzMenu(); startTick(); }

    tzToggle.addEventListener("click", (e)=>{ e.stopPropagation(); tzMenu.classList.contains("open") ? closeTzMenu() : openTzMenu(); });
    tzSearch.addEventListener("input", (e)=> renderTzList(e.target.value));
    document.addEventListener("click", (e)=>{ if (!tzMenu.contains(e.target) && e.target !== tzToggle) closeTzMenu(); });
    document.addEventListener("keydown", (e)=>{ if (e.key === "Escape") closeTzMenu(); });

    (function initPicker(){
      const saved = localStorage.getItem("boss_timezone");
      const defaultTZ = "Europe/Vienna";  // shows as CEST in summer for users
      const tz = saved || defaultTZ;
      tzCurrent.textContent = `${tz} (${utcOffsetLabel(tz)})`;
    })();

    let tickHandle = null;
    function startTick(){
      if (tickHandle) clearInterval(tickHandle);
      const tz = (localStorage.getItem("boss_timezone")) || "Europe/Vienna";
      function tick(){
        const now = new Date();
        BOSSES.forEach((b,i)=>{
          const next = b.fixedCET ? nextFromFixedCEST(b.fixedCET) : nextFromResetInterval(b.interval);
          const diff = next - now;
          const nextEl = document.getElementById(`next-${i}`);
          const cdEl = document.getElementById(`cd-${i}`);
          nextEl.textContent = fmtHMInTZ(next, tz);
          nextEl.classList.toggle("soon", diff <= 15*60*1000 && diff > 0);
          cdEl.classList.toggle("now", diff <= 5*1000);
          cdEl.textContent = diff <= 0 ? "SPAWNING…" : fmtHMS(diff);
        });
      }
      tick();
      tickHandle = setInterval(tick, 1000);
    }

    buildRows();
    startTick();
  </script>
</body>
</html>






